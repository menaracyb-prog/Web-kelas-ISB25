<!DOCTYPE html>
<html lang="id">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Portal Akademik ISB 25</title>  
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">  <style>  
    :root {  
        --primary: #4361ee;  
        --secondary: #3f37c9;  
        --accent: #4cc9f0;  
        --dark: #0f172a;  
        --panel: #1e293b;  
        --text: #f1f5f9;  
        --gray: #94a3b8;  
        --success: #10b981;  
        --danger: #ef4444;  
        --warning: #f59e0b;  
    }  

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }  

    body {  
        background-color: var(--dark);  
        color: var(--text);  
        min-height: 100vh;  
        overflow-x: hidden;  
    }  

    .hidden { display: none !important; }  
    .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 500; transition: 0.2s; display: inline-flex; align-items: center; gap: 5px; }  
    .btn-primary { background: var(--primary); color: white; }  
    .btn-primary:hover { background: var(--secondary); }  
    .btn-danger { background: var(--danger); color: white; }  
    .btn-success { background: var(--success); color: white; }  
    .btn-warning { background: var(--warning); color: black; }  
      
    /* Toast */  
    #toast {  
        position: fixed; top: 20px; right: 20px;  
        background: var(--panel); border-left: 5px solid var(--primary);  
        padding: 15px 25px; border-radius: 8px;  
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);  
        transform: translateX(150%); transition: 0.3s; z-index: 2000;  
    }  
    #toast.show { transform: translateX(0); }  

    /* Auth Section */  
    #auth-section {  
        min-height: 100vh;  
        background: radial-gradient(circle at top right, #1e1b4b, var(--dark)),  
                    radial-gradient(circle at bottom left, #312e81, var(--dark));  
        display: flex; flex-direction: column;  
    }  
    .auth-container { flex-grow: 1; display: flex; align-items: center; justify-content: center; padding: 20px; }  
    .auth-box {  
        background: rgba(30, 41, 59, 0.9); backdrop-filter: blur(12px);  
        border: 1px solid rgba(255,255,255,0.1); padding: 2.5rem;  
        border-radius: 20px; width: 100%; max-width: 420px;  
        box-shadow: 0 10px 40px rgba(0,0,0,0.4);  
    }  
    .auth-header { text-align: center; margin-bottom: 2rem; }  
    .form-group { margin-bottom: 1.2rem; }  
    .form-control {  
        width: 100%; padding: 12px; background: rgba(0,0,0,0.3);  
        border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;  
        color: white; outline: none;  
    }  
    .auth-switch { text-align: center; margin-top: 1.5rem; font-size: 0.9rem; }  
    .auth-switch span { color: var(--primary); cursor: pointer; text-decoration: underline; }  

    /* Dashboard Layout */  
    #dashboard-section { display: flex; height: 100vh; background: var(--dark); }  
    .sidebar {  
        width: 260px; background: var(--panel); border-right: 1px solid rgba(255,255,255,0.05);  
        display: flex; flex-direction: column; padding: 20px; overflow-y: auto;  
    }  
    .brand { font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 2rem; display: flex; align-items: center; gap: 10px; }  
    .brand i { color: var(--primary); }  
    .nav-menu { list-style: none; flex-grow: 1; }  
    .nav-item { margin-bottom: 5px; }  
    .nav-link {  
        display: flex; align-items: center; gap: 12px; padding: 12px 15px;  
        color: var(--gray); text-decoration: none; border-radius: 8px; transition: 0.2s; cursor: pointer;  
    }  
    .nav-link:hover, .nav-link.active { background: rgba(67, 97, 238, 0.1); color: var(--accent); }  
      
    .main-content { flex: 1; padding: 30px; overflow-y: auto; }  
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }  
      
    /* Cards & Grids */  
    .grid-container {  
        display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;  
    }  
    .card {  
        background: var(--panel); border-radius: 12px; padding: 20px;  
        border: 1px solid rgba(255,255,255,0.05); position: relative;  
    }  

    /* Tables */  
    .table-responsive { overflow-x: auto; }  
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }  
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.05); }  
    th { color: var(--accent); font-size: 0.85rem; }  

    /* Gallery Styles */  
    .gallery-grid {  
        display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;  
    }  
    .gallery-item {  
        border-radius: 10px; overflow: hidden; position: relative; aspect-ratio: 1;  
        cursor: pointer; border: 2px solid transparent; transition: 0.3s;  
        background: #000;  
    }  
    .gallery-item:hover { border-color: var(--primary); transform: scale(1.02); }  
    .gallery-item img { width: 100%; height: 100%; object-fit: cover; }  
    .delete-img-btn {  
        position: absolute; top: 5px; right: 5px; background: rgba(239, 68, 68, 0.9);  
        color: white; border: none; border-radius: 50%; width: 30px; height: 30px;  
        display: none; align-items: center; justify-content: center; cursor: pointer;  
        font-size: 0.9rem;  
    }  
    .gallery-item:hover .delete-img-btn { display: flex; }  

    /* File Input Styling */  
    .file-upload-wrapper {  
        position: relative; overflow: hidden; display: inline-block;  
    }  
    .file-upload-wrapper input[type=file] {  
        font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0;  
    }  

    /* Modal Styles */  
    .modal {  
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;  
        background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center;  
        z-index: 1500; opacity: 0; pointer-events: none; transition: 0.3s;  
    }  
    .modal.active { opacity: 1; pointer-events: all; }  
    .modal-content {  
        background: var(--panel); padding: 2rem; border-radius: 15px; width: 90%; max-width: 500px;  
        border: 1px solid var(--border); max-height: 90vh; overflow-y: auto;  
    }  

    /* Responsive */  
    @media (max-width: 768px) {  
        .sidebar { position: fixed; left: -260px; z-index: 100; height: 100%; transition: 0.3s; box-shadow: 5px 0 15px rgba(0,0,0,0.5); }  
        .sidebar.active { left: 0; }  
        .mobile-toggle { display: block; font-size: 1.5rem; cursor: pointer; }  
    }  
    @media (min-width: 769px) { .mobile-toggle { display: none; } }  
</style>

</head>  
<body>  <!-- Toast -->  
<div id="toast">Notifikasi</div>  

<!-- Auth Section -->  
<section id="auth-section">  
    <div class="auth-container">  
        <div id="login-form" class="auth-box">  
            <div class="auth-header">  
                <h1 style="color:var(--accent);">ISB 25</h1>  
                <p style="color:var(--gray);">Portal Akademik</p>  
            </div>  
            <form onsubmit="handleLogin(event)">  
                <div class="form-group">  
                    <input type="text" id="login-user" class="form-control" placeholder="Username" required>  
                </div>  
                <div class="form-group">  
                    <input type="password" id="login-pass" class="form-control" placeholder="Password" required>  
                </div>  
                <button type="submit" class="btn btn-primary" style="width:100%;">Masuk</button>  
                <div class="auth-switch">  
                    Belum punya akun? <span onclick="toggleAuth('register')">Daftar</span>  
                </div>  
                <div style="margin-top:15px; font-size:0.8rem; color:var(--gray); text-align:center; background:rgba(255,255,255,0.05); padding:10px; border-radius:5px;">  
                    Harap daftar dengan password yang mudah di ingat supaya tidak terjadi hal yang tidak di inginkan kemudian Hari
                    Terimakasih<br>User: Silakan daftar  
                </div>  
            </form>  
        </div>  

        <div id="register-form" class="auth-box hidden">  
            <div class="auth-header">  
                <h1>Daftar</h1>  
                <p>Bergabung dengan ISB 25</p>  
            </div>  
            <form onsubmit="handleRegister(event)">  
                <div class="form-group">  
                    <input type="text" id="reg-name" class="form-control" placeholder="Nama Lengkap" required>  
                </div>  
                <div class="form-group">  
                    <input type="text" id="reg-user" class="form-control" placeholder="Username" required>  
                </div>  
                <div class="form-group">  
                    <input type="password" id="reg-pass" class="form-control" placeholder="Password" required>  
                </div>  
                <button type="submit" class="btn btn-success" style="width:100%;">Daftar</button>  
                <div class="auth-switch">  
                    Sudah punya akun? <span onclick="toggleAuth('login')">Login</span>  
                </div>  
            </form>  
        </div>  
    </div>  
</section>  

<!-- Dashboard Section -->  
<section id="dashboard-section" class="hidden">  
    <nav class="sidebar" id="sidebar">  
        <div class="brand"><i class="fas fa-university"></i> ISB 25</div>  
        <ul class="nav-menu">  
            <li class="nav-item"><a class="nav-link active" onclick="renderDashboard()"><i class="fas fa-home"></i> Dashboard</a></li>  
            <li class="nav-item admin-only hidden"><a class="nav-link" onclick="renderRegistrations()"><i class="fas fa-user-plus"></i> Pendaftaran</a></li>  
            <li class="nav-item"><a class="nav-link" onclick="renderSchedule()"><i class="fas fa-calendar-alt"></i> Jadwal MK</a></li>  
            <!-- Task menu accessible to everyone -->  
            <li class="nav-item"><a class="nav-link" onclick="renderTasks()"><i class="fas fa-tasks"></i> Tugas & Deadline</a></li>  
            <li class="nav-item"><a class="nav-link" onclick="renderGallery()"><i class="fas fa-images"></i> Galeri</a></li>  
        </ul>  
        <div style="margin-top:auto; padding-top:20px; border-top:1px solid rgba(255,255,255,0.1);">  
            <div style="display:flex; justify-content:space-between; align-items:center;">  
                <span id="profile-display" style="font-size:0.9rem;">User</span>  
                <button class="btn btn-danger" onclick="logout()" style="padding:5px 10px;"><i class="fas fa-sign-out-alt"></i></button>  
            </div>  
        </div>  
    </nav>  

    <main class="main-content">  
        <div class="page-header">  
            <div style="display:flex; align-items:center; gap:15px;">  
                <i class="fas fa-bars mobile-toggle" onclick="toggleSidebar()"></i>  
                <h2 id="page-title">Dashboard</h2>  
            </div>  
        </div>  
        <div id="content-area"></div>  
    </main>  
</section>  

<!-- Modal: Tambah Jadwal MK -->  
<div id="modal-schedule" class="modal">  
    <div class="modal-content">  
        <h3 style="margin-bottom:15px;">Atur Jadwal Mata Kuliah</h3>  
        <form onsubmit="saveSchedule(event)">  
            <input type="hidden" id="sched-id">  
            <div class="form-group"><label>Hari</label>  
                <select id="sched-day" class="form-control"><option>Senin</option><option>Selasa</option><option>Rabu</option><option>Kamis</option><option>Jumat</option></select>  
            </div>  
            <div class="form-group"><label>Jam</label>  
                <input type="text" id="sched-time" class="form-control" placeholder="08:00 - 10:00" required>  
            </div>  
            <div class="form-group"><label>Mata Kuliah</label>  
                <input type="text" id="sched-subject" class="form-control" placeholder="Nama MK" required>  
            </div>  
            <div class="form-group"><label>Ruang</label>  
                <input type="text" id="sched-room" class="form-control" placeholder="R-101" required>  
            </div>  
            <div style="display:flex; gap:10px; justify-content:flex-end;">  
                <button type="button" class="btn" style="background:#555; color:white;" onclick="closeModal('modal-schedule')">Batal</button>  
                <button type="submit" class="btn btn-primary">Simpan</button>  
            </div>  
        </form>  
    </div>  
</div>  

<!-- Modal: Tambah Tugas -->  
<div id="modal-task" class="modal">  
    <div class="modal-content">  
        <h3 style="margin-bottom:15px;">Kelola Tugas</h3>  
        <form onsubmit="saveTask(event)">  
            <input type="hidden" id="task-id">  
            <div class="form-group"><label>Mata Kuliah</label>  
                <input type="text" id="task-subject" class="form-control" required>  
            </div>  
            <div class="form-group"><label>Deskripsi Tugas</label>  
                <input type="text" id="task-desc" class="form-control" required>  
            </div>  
            <div class="form-group"><label>Deadline</label>  
                <input type="date" id="task-date" class="form-control" required>  
            </div>  
            <div style="display:flex; gap:10px; justify-content:flex-end;">  
                <button type="button" class="btn" style="background:#555; color:white;" onclick="closeModal('modal-task')">Batal</button>  
                <button type="submit" class="btn btn-primary">Simpan</button>  
            </div>  
        </form>  
    </div>  
</div>  

<!-- Modal: Upload Foto Galeri -->  
<div id="modal-gallery" class="modal">  
    <div class="modal-content">  
        <h3 style="margin-bottom:15px;">Tambah Foto Galeri</h3>  
        <form onsubmit="uploadGalleryPhoto(event)">  
            <div class="form-group">  
                <label>Pilih Foto dari HP/Komputer</label>  
                <div style="border: 2px dashed var(--gray); padding: 20px; text-align: center; border-radius: 8px; margin-top: 5px; cursor: pointer;" onclick="document.getElementById('file-input').click()">  
                    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--accent); margin-bottom: 10px;"></i>  
                    <p style="font-size: 0.9rem;">Klik untuk memilih file</p>  
                    <p id="file-name" style="font-size: 0.8rem; color: var(--success); margin-top: 5px; font-weight: bold;"></p>  
                </div>  
                <input type="file" id="file-input" class="hidden" accept="image/*" required onchange="handleFileSelect(this)">  
            </div>  
              
            <!-- Preview Image -->  
            <div id="preview-container" style="text-align: center; margin: 15px 0; display: none;">  
                <img id="img-preview" src="" style="max-width: 100%; max-height: 200px; border-radius: 8px;">  
            </div>  

            <div style="display:flex; gap:10px; justify-content:flex-end;">  
                <button type="button" class="btn" style="background:#555; color:white;" onclick="closeModal('modal-gallery')">Batal</button>  
                <button type="submit" class="btn btn-primary" id="btn-upload">Upload</button>  
            </div>  
        </form>  
    </div>  
</div>  

<script>  
    // --- DATA STORE (LOCAL STORAGE) ---  
    let users = JSON.parse(localStorage.getItem('isb25_users')) || [{id:1, name:"cybradmin", username:"cybradmin", password:"cybradmin", role:"cybradmin", joined:"2023-01-01"}];  
      
    let schedules = JSON.parse(localStorage.getItem('isb25_schedules')) || [  
        {id:1, day:"Senin", time:"08:00 - 10:00", subject:"Pemrograman Web", room:"Lab 1"},  
        {id:2, day:"Rabu", time:"10:00 - 12:00", subject:"Basis Data", room:"R-202"}  
    ];  

    let tasks = JSON.parse(localStorage.getItem('isb25_tasks')) || [  
        {id:1, subject:"Web Design", desc:"Buat Landing Page", date:"2024-12-31"},  
        {id:2, subject:"Algoritma", desc:"Tugas Harian 3", date:"2025-01-05"}  
    ];  

    let gallery = JSON.parse(localStorage.getItem('isb25_gallery')) || [];  

    let currentUser = null;  

    // --- AUTH ---  
    function toggleAuth(t) {  
        if(t==='register') {  
            document.getElementById('login-form').classList.add('hidden');  
            document.getElementById('register-form').classList.remove('hidden');  
        } else {  
            document.getElementById('register-form').classList.add('hidden');  
            document.getElementById('login-form').classList.remove('hidden');  
        }  
    }  

    function handleRegister(e) {  
        e.preventDefault();  
        const name = document.getElementById('reg-name').value;  
        const user = document.getElementById('reg-user').value;  
        const pass = document.getElementById('reg-pass').value;  

        if(users.find(u => u.username === user)) return showToast("Username sudah ada!", "error");  
          
        users.push({id:Date.now(), name, username:user, password:pass, role:"user", joined:new Date().toLocaleDateString()});  
        localStorage.setItem('isb25_users', JSON.stringify(users));  
        showToast("Registrasi berhasil! Silakan login.");  
        toggleAuth('login');  
    }  

    function handleLogin(e) {  
        e.preventDefault();  
        const u = document.getElementById('login-user').value;  
        const p = document.getElementById('login-pass').value;  
        const found = users.find(x => x.username === u && x.password === p);  
          
        if(found) {  
            currentUser = found;  
            document.getElementById('auth-section').classList.add('hidden');  
            document.getElementById('dashboard-section').classList.remove('hidden');  
            document.getElementById('profile-display').innerText = `${currentUser.name} (${currentUser.role})`;  
              
            document.querySelectorAll('.admin-only').forEach(el => {  
                el.classList.toggle('hidden', currentUser.role !== 'admin');  
            });  
              
            renderDashboard();  
        } else {  
            showToast("Username/Password salah", "error");  
        }  
    }  

    function logout() {  
        currentUser = null;  
        document.getElementById('dashboard-section').classList.add('hidden');  
        document.getElementById('auth-section').classList.remove('hidden');  
    }  

    // --- UTILITIES ---
    // Fungsi untuk menutup sidebar otomatis di tampilan Mobile
    function closeMobileSidebar() {
        const sidebar = document.getElementById('sidebar');
        if (window.innerWidth <= 768) {
            sidebar.classList.remove('active');
        }
    }

    // --- NAVIGATION & RENDER ---  
    function renderDashboard() {  
        closeMobileSidebar(); // MEMANGGIL FUNGSI CLOSE SIDEBAR
        
        document.getElementById('page-title').innerText = "Dashboard";  
        const isAdmin = currentUser.role === 'admin';  
          
        let html = `  
            <div class="grid-container">  
                <div class="card" style="border-left: 4px solid var(--primary);">  
                    <h3>${users.length}</h3><p>Total Pengguna</p>  
                </div>  
                <div class="card" style="border-left: 4px solid var(--accent);">  
                    <h3>${schedules.length}</h3><p>Jadwal Minggu Ini</p>  
                </div>  
                <div class="card" style="border-left: 4px solid var(--warning);">  
                    <h3>${tasks.length}</h3><p>Tugas Aktif</p>  
                </div>  
            </div>  
            <div class="card">  
                <h3>ðŸ‘‹ Halo, ${currentUser.name}!</h3>  
                <p style="margin-top:10px; color:var(--gray);">Selamat datang di portal kelas ISB 25. Jangan lupa cek jadwal dan deadline tugas minggu ini.</p>  
            </div>  
        `;  
        document.getElementById('content-area').innerHTML = html;  
        setActiveLink(0);  
    }  

    function renderSchedule() {  
        closeMobileSidebar(); // MEMANGGIL FUNGSI CLOSE SIDEBAR

        document.getElementById('page-title').innerText = "Jadwal Mata Kuliah";  
        setActiveLink(2);  
          
        let btnHtml = currentUser.role === 'admin'   
            ? `<button class="btn btn-primary" onclick="openAddSchedule()"><i class="fas fa-plus"></i> Tambah</button>`   
            : '';  

        let rows = schedules.map(s => `  
            <tr>  
                <td>${s.day}</td>  
                <td>${s.time}</td>  
                <td><b>${s.subject}</b></td>  
                <td>${s.room}</td>  
                ${currentUser.role === 'admin' ?   
                `<td>  
                    <button class="btn btn-warning" onclick="editSchedule(${s.id})"><i class="fas fa-edit"></i></button>  
                    <button class="btn btn-danger" onclick="delSchedule(${s.id})"><i class="fas fa-trash"></i></button>  
                </td>` : ''}  
            </tr>  
        `).join('');  

        document.getElementById('content-area').innerHTML = `  
            <div class="card">  
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">  
                    <h3>Jadwal Perkuliahan Minggu Ini</h3>  
                    ${btnHtml}  
                </div>  
                <div class="table-responsive">  
                    <table>  
                        <thead><tr><th>Hari</th><th>Jam</th><th>Mata Kuliah</th><th>Ruang</th>${currentUser.role === 'admin' ? '<th>Aksi</th>' : ''}</tr></thead>  
                        <tbody>${rows}</tbody>  
                    </table>  
                </div>  
            </div>  
        `;  
    }  

    function renderTasks() {  
        closeMobileSidebar(); // MEMANGGIL FUNGSI CLOSE SIDEBAR

        document.getElementById('page-title').innerText = "Jadwal Tugas & Deadline";  
        setActiveLink(3);  

        // Tombol Tambah HANYA muncul untuk Admin  
        let btnHtml = currentUser.role === 'admin'   
            ? `<button class="btn btn-primary" onclick="openAddTask()"><i class="fas fa-plus"></i> Tambah Tugas</button>`   
            : '';  

        let rows = tasks.map(t => {  
            const isLate = new Date(t.date) < new Date().setHours(0,0,0,0);  
            const dateColor = isLate ? 'var(--danger)' : 'var(--text)';  
            const badge = isLate ? '<span class="badge" style="background:var(--danger); padding:2px 8px; border-radius:4px; font-size:0.7rem; margin-left:5px;">Terlewat</span>' : '';  

            // Tombol Edit/Delete HANYA muncul untuk Admin  
            const actionBtns = currentUser.role === 'admin' ? `  
                <button class="btn btn-warning" onclick="editTask(${t.id})"><i class="fas fa-edit"></i></button>  
                <button class="btn btn-danger" onclick="delTask(${t.id})"><i class="fas fa-trash"></i></button>  
            ` : '<span style="color:var(--gray); font-size:0.8rem;">(Lihat Saja)</span>';  

            return `  
            <tr>  
                <td>${t.subject}</td>  
                <td>${t.desc}</td>  
                <td style="color:${dateColor}">${t.date} ${badge}</td>  
                <td>${actionBtns}</td>  
            </tr>`;  
        }).join('');  

        document.getElementById('content-area').innerHTML = `  
            <div class="card">  
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">  
                    <h3>Daftar Tugas Kelas</h3>  
                    ${btnHtml}  
                </div>  
                <div class="table-responsive">  
                    <table>  
                        <thead><tr><th>MK</th><th>Deskripsi</th><th>Deadline</th><th>Aksi</th></tr></thead>  
                        <tbody>${rows}</tbody>  
                    </table>  
                </div>  
            </div>  
        `;  
    }  

    function renderGallery() {  
        closeMobileSidebar(); // MEMANGGIL FUNGSI CLOSE SIDEBAR

        document.getElementById('page-title').innerText = "Galeri Kelas";  
        setActiveLink(4);  

        // Tombol Upload HANYA untuk Admin  
        let btnHtml = currentUser.role === 'admin'   
            ? `<button class="btn btn-primary" onclick="openUploadModal()"><i class="fas fa-upload"></i> Upload Foto</button>`   
            : '';  

        let photos = gallery.map(img => `  
            <div class="gallery-item">  
                <img src="${img.url}" alt="Gallery">  
                ${currentUser.role === 'admin' ? `<button class="delete-img-btn" onclick="delPhoto(${img.id})"><i class="fas fa-trash"></i></button>` : ''}  
            </div>  
        `).join('');  

        if(photos.length === 0) {  
            photos = `<div style="grid-column: 1/-1; text-align:center; padding: 40px; color: var(--gray);">Belum ada foto di galeri.</div>`;  
        }  

        document.getElementById('content-area').innerHTML = `  
            <div style="margin-bottom:20px;">${btnHtml}</div>  
            <div class="gallery-grid">  
                ${photos}  
            </div>  
        `;  
    }  

    function renderRegistrations() {  
        closeMobileSidebar(); // MEMANGGIL FUNGSI CLOSE SIDEBAR

        document.getElementById('page-title').innerText = "Data Pendaftaran";  
        setActiveLink(1);  
        const regUsers = users.filter(u => u.role === 'user');  
          
        let rows = regUsers.map(u => `  
            <tr>  
                <td>${u.name}</td>  
                <td>${u.username}</td>  
                <td>${u.joined}</td>  
                <td><button class="btn btn-danger" onclick="delUser(${u.id})">Hapus</button></td>  
            </tr>  
        `).join('');  

        document.getElementById('content-area').innerHTML = `  
            <div class="card">  
                <h3>User yang Mendaftar Sendiri</h3>  
                <div class="table-responsive">  
                    <table><thead><tr><th>Nama</th><th>Username</th><th>Gabung</th><th>Aksi</th></tr></thead><tbody>${rows}</tbody></table>  
                </div>  
            </div>  
        `;  
    }  

    // --- CRUD LOGIC: SCHEDULE ---  
    function openAddSchedule() { document.getElementById('modal-schedule').classList.add('active'); document.getElementById('sched-id').value=''; }  
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }  
      
    function saveSchedule(e) {  
        e.preventDefault();  
        const id = document.getElementById('sched-id').value;  
        const newData = {  
            id: id ? parseInt(id) : Date.now(),  
            day: document.getElementById('sched-day').value,  
            time: document.getElementById('sched-time').value,  
            subject: document.getElementById('sched-subject').value,  
            room: document.getElementById('sched-room').value  
        };  

        if(id) {  
            const idx = schedules.findIndex(x => x.id == id);  
            schedules[idx] = newData;  
        } else {  
            schedules.push(newData);  
        }  
        localStorage.setItem('isb25_schedules', JSON.stringify(schedules));  
        closeModal('modal-schedule');  
        renderSchedule();  
        showToast("Jadwal disimpan");  
    }  

    function editSchedule(id) {  
        const s = schedules.find(x => x.id == id);  
        document.getElementById('sched-id').value = s.id;  
        document.getElementById('sched-day').value = s.day;  
        document.getElementById('sched-time').value = s.time;  
        document.getElementById('sched-subject').value = s.subject;  
        document.getElementById('sched-room').value = s.room;  
        document.getElementById('modal-schedule').classList.add('active');  
    }  

    function delSchedule(id) {  
        if(confirm('Hapus jadwal ini?')) {  
            schedules = schedules.filter(x => x.id != id);  
            localStorage.setItem('isb25_schedules', JSON.stringify(schedules));  
            renderSchedule();  
        }  
    }  

    // --- CRUD LOGIC: TASKS ---  
    function openAddTask() { document.getElementById('modal-task').classList.add('active'); document.getElementById('task-id').value=''; }  
      
    function saveTask(e) {  
        e.preventDefault();  
        const id = document.getElementById('task-id').value;  
        const newData = {  
            id: id ? parseInt(id) : Date.now(),  
            subject: document.getElementById('task-subject').value,  
            desc: document.getElementById('task-desc').value,  
            date: document.getElementById('task-date').value  
        };  

        if(id) {  
            const idx = tasks.findIndex(x => x.id == id);  
            tasks[idx] = newData;  
        } else {  
            tasks.push(newData);  
        }  
        localStorage.setItem('isb25_tasks', JSON.stringify(tasks));  
        closeModal('modal-task');  
        renderTasks();  
        showToast("Tugas disimpan");  
    }  

    function editTask(id) {  
        const t = tasks.find(x => x.id == id);  
        document.getElementById('task-id').value = t.id;  
        document.getElementById('task-subject').value = t.subject;  
        document.getElementById('task-desc').value = t.desc;  
        document.getElementById('task-date').value = t.date;  
        document.getElementById('modal-task').classList.add('active');  
    }  

    function delTask(id) {  
        if(confirm('Hapus tugas ini?')) {  
            tasks = tasks.filter(x => x.id != id);  
            localStorage.setItem('isb25_tasks', JSON.stringify(tasks));  
            renderTasks();  
        }  
    }  

    // --- GALLERY LOGIC (REAL UPLOAD) ---  
    function openUploadModal() {  
        // Reset form  
        document.getElementById('file-input').value = '';  
        document.getElementById('file-name').innerText = '';  
        document.getElementById('img-preview').src = '';  
        document.getElementById('preview-container').style.display = 'none';  
        document.getElementById('modal-gallery').classList.add('active');  
    }  

    function handleFileSelect(input) {  
        if (input.files && input.files[0]) {  
            const file = input.files[0];  
              
            // Show File Name  
            document.getElementById('file-name').innerText = file.name;  

            // Show Preview  
            const reader = new FileReader();  
            reader.onload = function(e) {  
                document.getElementById('img-preview').src = e.target.result;  
                document.getElementById('preview-container').style.display = 'block';  
            }  
            reader.readAsDataURL(file);  
        }  
    }  

    function uploadGalleryPhoto(event) {  
        event.preventDefault();  
        const fileInput = document.getElementById('file-input');  
          
        if (fileInput.files && fileInput.files[0]) {  
            const file = fileInput.files[0];  
            const reader = new FileReader();  

            // Show loading state  
            const btn = document.getElementById('btn-upload');  
            const originalText = btn.innerText;  
            btn.innerText = "Uploading...";  
            btn.disabled = true;  

            reader.onload = function(e) {  
                // Simpan Base64 string ke array gallery  
                gallery.push({  
                    id: Date.now(),  
                    url: e.target.result // Ini adalah data gambar asli  
                });  

                // Simpan ke localStorage  
                try {  
                    localStorage.setItem('isb25_gallery', JSON.stringify(gallery));  
                    showToast("Foto berhasil ditambahkan!");  
                    closeModal('modal-gallery');  
                    renderGallery();  
                } catch (err) {  
                    showToast("Gagal: Ukuran foto terlalu besar untuk penyimpanan browser.", "error");  
                    console.error(err);  
                } finally {  
                    btn.innerText = originalText;  
                    btn.disabled = false;  
                }  
            };              
            reader.readAsDataURL(file);  
        } else {  
            showToast("Pilih foto terlebih dahulu!", "error");  
        }  
    }  

    function delPhoto(id) {  
        if(confirm("Hapus foto ini?")) {  
            gallery = gallery.filter(x => x.id != id);  
            localStorage.setItem('isb25_gallery', JSON.stringify(gallery));  
            renderGallery();  
        }  
    }  

    function delUser(id) {  
        if(confirm("Hapus User ini?")) {  
            users = users.filter(u => u.id != id);  
            localStorage.setItem('isb25_users', JSON.stringify(users));  
            renderRegistrations();  
        }  
    }  

    // --- UTILS ---  
    function showToast(msg, type='success') {  
        const t = document.getElementById('toast');  
        t.innerText = msg;  
        t.style.borderLeftColor = type === 'error' ? 'var(--danger)' : 'var(--success)';  
        t.classList.add('show');  
        setTimeout(() => t.classList.remove('show'), 3000);  
    }  
    function toggleSidebar() {  
        document.getElementById('sidebar').classList.toggle('active');  
    }  
    function setActiveLink(idx) {  
        document.querySelectorAll('.nav-link').forEach((l, i) => {  
            if(i === idx) l.classList.add('active'); else l.classList.remove('active');  
        });  
    }  
</script>

</body>  
</html>